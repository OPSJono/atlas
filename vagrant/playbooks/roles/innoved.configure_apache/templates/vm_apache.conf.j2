<VirtualHost *:80>
    ServerName vagrant.local.vm
    ServerAlias *.local.vm
    DocumentRoot /vagrant/api/laravel/public/

    # This will enable the Rewrite capabilities
    RewriteEngine On
    # This checks to make sure the connection is not already HTTPS
    RewriteCond %{HTTP:X-Forwarded-Proto} https
    # Force to HTTP
    RewriteRule ^ http://%{SERVER_NAME}%{REQUEST_URI} [L,R]

    <Directory /vagrant/api/laravel/public/>
        Options FollowSymLinks
        AllowOverride all
        Order allow,deny
        Allow from all
        Require all granted
    </Directory>

    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>

    Header set X-Frame-Options SAMEORIGIN
    Header set remote-address {{ inventory_hostname }}

    SetEnv INNOVED_PUBLIC_PATH /vagrant/public
    SetEnv INNOVED_CONFIG_PATH /vagrant/config
    SetEnv INNOVED_DATA_PATH /vagrant/data
    SetEnv INNOVED_CODE_PATH /vagrant/src
    SetEnv INNOVED_LARAVEL_PATH /vagrant/api/laravel

    SetEnv LARAVEL_ENVIRONMENT development

    LogLevel info
    LogFormat "%{X-Forwarded-For}i %h %l %u %t \"%r\" %>s %b %D %T %k \"%{Referer}i\" \"%{User-Agent}i\" \"%{X-Amzn-Trace-Id}i\"" custom

    ErrorLog "${APACHE_LOG_DIR}/vle/development-local-error.log"
    CustomLog "${APACHE_LOG_DIR}/vle/development-local-access.log" custom

    DirectoryIndex index.php index.html

    SSLProxyEngine on
    <LocationMatch "/ReportServer/">
        ProxyPass "https://reporting.innovedvle.co.uk:443/ReportServer/"
        ProxyPassReverse "https://reporting.innovedvle.co.uk:443/ReportServer/"
        RequestHeader set Authorization "Basic RU1TVGVzdFVzZXI6VGRRa2U1I1JKVmtsSjdsYzgxTTRwZDh2VjUkIVMzajZYVktvbDQ4aWJscnV1ZVc3"
        SetEnv force-proxy-request-1.0 1
        SetEnv proxy-nokeepalive 1
    </LocationMatch>
</VirtualHost>

